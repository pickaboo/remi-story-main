
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for remi-story-main/src/services/geminiService.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">remi-story-main/src/services</a> geminiService.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/214</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/214</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a>
<a name='L155'></a><a href='#L155'>155</a>
<a name='L156'></a><a href='#L156'>156</a>
<a name='L157'></a><a href='#L157'>157</a>
<a name='L158'></a><a href='#L158'>158</a>
<a name='L159'></a><a href='#L159'>159</a>
<a name='L160'></a><a href='#L160'>160</a>
<a name='L161'></a><a href='#L161'>161</a>
<a name='L162'></a><a href='#L162'>162</a>
<a name='L163'></a><a href='#L163'>163</a>
<a name='L164'></a><a href='#L164'>164</a>
<a name='L165'></a><a href='#L165'>165</a>
<a name='L166'></a><a href='#L166'>166</a>
<a name='L167'></a><a href='#L167'>167</a>
<a name='L168'></a><a href='#L168'>168</a>
<a name='L169'></a><a href='#L169'>169</a>
<a name='L170'></a><a href='#L170'>170</a>
<a name='L171'></a><a href='#L171'>171</a>
<a name='L172'></a><a href='#L172'>172</a>
<a name='L173'></a><a href='#L173'>173</a>
<a name='L174'></a><a href='#L174'>174</a>
<a name='L175'></a><a href='#L175'>175</a>
<a name='L176'></a><a href='#L176'>176</a>
<a name='L177'></a><a href='#L177'>177</a>
<a name='L178'></a><a href='#L178'>178</a>
<a name='L179'></a><a href='#L179'>179</a>
<a name='L180'></a><a href='#L180'>180</a>
<a name='L181'></a><a href='#L181'>181</a>
<a name='L182'></a><a href='#L182'>182</a>
<a name='L183'></a><a href='#L183'>183</a>
<a name='L184'></a><a href='#L184'>184</a>
<a name='L185'></a><a href='#L185'>185</a>
<a name='L186'></a><a href='#L186'>186</a>
<a name='L187'></a><a href='#L187'>187</a>
<a name='L188'></a><a href='#L188'>188</a>
<a name='L189'></a><a href='#L189'>189</a>
<a name='L190'></a><a href='#L190'>190</a>
<a name='L191'></a><a href='#L191'>191</a>
<a name='L192'></a><a href='#L192'>192</a>
<a name='L193'></a><a href='#L193'>193</a>
<a name='L194'></a><a href='#L194'>194</a>
<a name='L195'></a><a href='#L195'>195</a>
<a name='L196'></a><a href='#L196'>196</a>
<a name='L197'></a><a href='#L197'>197</a>
<a name='L198'></a><a href='#L198'>198</a>
<a name='L199'></a><a href='#L199'>199</a>
<a name='L200'></a><a href='#L200'>200</a>
<a name='L201'></a><a href='#L201'>201</a>
<a name='L202'></a><a href='#L202'>202</a>
<a name='L203'></a><a href='#L203'>203</a>
<a name='L204'></a><a href='#L204'>204</a>
<a name='L205'></a><a href='#L205'>205</a>
<a name='L206'></a><a href='#L206'>206</a>
<a name='L207'></a><a href='#L207'>207</a>
<a name='L208'></a><a href='#L208'>208</a>
<a name='L209'></a><a href='#L209'>209</a>
<a name='L210'></a><a href='#L210'>210</a>
<a name='L211'></a><a href='#L211'>211</a>
<a name='L212'></a><a href='#L212'>212</a>
<a name='L213'></a><a href='#L213'>213</a>
<a name='L214'></a><a href='#L214'>214</a>
<a name='L215'></a><a href='#L215'>215</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" >/// &lt;reference path="../types.ts" /&gt;<span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" ></span></span></span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >import { GoogleGenAI, GenerateContentResponse, Part } from "@google/genai";</span>
<span class="cstat-no" title="statement not covered" >import { GEMINI_TEXT_MODEL } from "../constants"; // GEMINI_IMAGE_MODEL was same as text, using text directly</span>
<span class="cstat-no" title="statement not covered" >import { UserDescriptionEntry } from "../types";</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >// Strict adherence to guideline: API key MUST be obtained from environment</span>
<span class="cstat-no" title="statement not covered" >// For Vite, environment variables prefixed with VITE_ are exposed on import.meta.env</span>
<span class="cstat-no" title="statement not covered" >const API_KEY = import.meta.env.VITE_API_KEY;</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >if (!API_KEY) {</span>
<span class="cstat-no" title="statement not covered" >  // Error handling for missing API key should be done where it's critical for app operation,</span>
<span class="cstat-no" title="statement not covered" >  // or the SDK itself might throw an error. Alerting here can be intrusive if the service</span>
<span class="cstat-no" title="statement not covered" >  // isn't immediately used or if the key is conditionally provided.</span>
<span class="cstat-no" title="statement not covered" >  // Consider a global app initialization check or rely on SDK errors.</span>
<span class="cstat-no" title="statement not covered" >  console.warn("Gemini API Key (VITE_API_KEY) is not configured in .env. Gemini features will not work.");</span>
<span class="cstat-no" title="statement not covered" >}</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >// Initialize with a fallback or handle the undefined case more gracefully if API_KEY might be missing.</span>
<span class="cstat-no" title="statement not covered" >// For now, assume API_KEY will be provided, or calls will fail.</span>
<span class="cstat-no" title="statement not covered" >const ai = new GoogleGenAI({ apiKey: API_KEY! }); </span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >export interface GeminiAnalysisResult {</span>
<span class="cstat-no" title="statement not covered" >  description: string;</span>
<span class="cstat-no" title="statement not covered" >  geotags: string[];</span>
<span class="cstat-no" title="statement not covered" >  aiGeneratedPlaceholder: string;</span>
<span class="cstat-no" title="statement not covered" >  timestamp: string;</span>
<span class="cstat-no" title="statement not covered" >}</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >export const analyzeImageWithGemini = async (base64ImageData: string, mimeType: string): Promise&lt;GeminiAnalysisResult&gt; =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  if (!API_KEY) {</span>
<span class="cstat-no" title="statement not covered" >    console.error("VITE_API_KEY not configured for analyzeImageWithGemini.");</span>
<span class="cstat-no" title="statement not covered" >    // Return a default error-indicating response that matches GeminiAnalysisResult</span>
<span class="cstat-no" title="statement not covered" >    return { description: "Gemini API-nyckel ej konfigurerad.", geotags: [], aiGeneratedPlaceholder: '', timestamp: new Date().toISOString() };</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    const imagePart: Part = {</span>
<span class="cstat-no" title="statement not covered" >      inlineData: {</span>
<span class="cstat-no" title="statement not covered" >        mimeType: mimeType,</span>
<span class="cstat-no" title="statement not covered" >        data: base64ImageData,</span>
<span class="cstat-no" title="statement not covered" >      },</span>
<span class="cstat-no" title="statement not covered" >    };</span>
<span class="cstat-no" title="statement not covered" >    const textPart: Part = {</span>
<span class="cstat-no" title="statement not covered" >      text: "Ge en objektiv och strikt faktabaserad beskrivning av den här bilden PÅ SVENSKA. Koncentrera dig uteslutande på vad som faktiskt syns: identifierbara objekt, personer (om några, beskriv deras uppenbara handlingar eller attribut utan spekulation), miljö/omgivning, dominerande färger och tydliga texturer. Undvik all form av tolkning, känslomässiga beskrivningar, poetiskt språk, konversationellt fluff, markdown-formatering (som asterisker eller listor), eller fraser som 'Den här bilden skildrar...' eller 'Vi ser...'. Leverera enbart den rena, direkta och neutrala observationen.\nSkriv sedan, på en ny rad, 'GEO_TAGS:' följt av en kommaseparerad lista med 2-5 potentiella geotaggar eller relevanta platsnyckelord PÅ SVENSKA baserat på bildinnehållet. Exempel: GEO_TAGS: Paris, Eiffeltornet, Frankrike"</span>
<span class="cstat-no" title="statement not covered" >    };</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    const response: GenerateContentResponse = await ai.models.generateContent({</span>
<span class="cstat-no" title="statement not covered" >      model: GEMINI_TEXT_MODEL, // GEMINI_TEXT_MODEL is 'gemini-2.5-flash-preview-04-17' which is vision capable</span>
<span class="cstat-no" title="statement not covered" >      contents: { parts: [imagePart, textPart] },</span>
<span class="cstat-no" title="statement not covered" >    });</span>
<span class="cstat-no" title="statement not covered" >    </span>
<span class="cstat-no" title="statement not covered" >    const rawText = response.text;</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    if (rawText === undefined) {</span>
<span class="cstat-no" title="statement not covered" >        console.error("[GeminiService] analyzeImageWithGemini: Gemini response text is undefined.");</span>
<span class="cstat-no" title="statement not covered" >        return { description: "Kunde inte analysera bilden (tomt svar från AI).", geotags: [], aiGeneratedPlaceholder: '', timestamp: new Date().toISOString() };</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    let description = rawText;</span>
<span class="cstat-no" title="statement not covered" >    let geotags: string[] = [];</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    const geotagMarker = "GEO_TAGS:";</span>
<span class="cstat-no" title="statement not covered" >    const geotagIndex = rawText.indexOf(geotagMarker);</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    if (geotagIndex !== -1) {</span>
<span class="cstat-no" title="statement not covered" >      description = rawText.substring(0, geotagIndex).trim();</span>
<span class="cstat-no" title="statement not covered" >      const geotagsString = rawText.substring(geotagIndex + geotagMarker.length).trim();</span>
<span class="cstat-no" title="statement not covered" >      if (geotagsString) {</span>
<span class="cstat-no" title="statement not covered" >        geotags = geotagsString.split(',').map(tag =&gt; tag.trim()).filter(tag =&gt; tag.length &gt; 0);</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" >    </span>
<span class="cstat-no" title="statement not covered" >    const analysisResult: GeminiAnalysisResult = {</span>
<span class="cstat-no" title="statement not covered" >      description: description || '',</span>
<span class="cstat-no" title="statement not covered" >      geotags: geotags || [],</span>
<span class="cstat-no" title="statement not covered" >      aiGeneratedPlaceholder: '',</span>
<span class="cstat-no" title="statement not covered" >      timestamp: new Date().toISOString(),</span>
<span class="cstat-no" title="statement not covered" >    };</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    return analysisResult;</span>
<span class="cstat-no" title="statement not covered" >  } catch (error) {</span>
<span class="cstat-no" title="statement not covered" >    console.error("Error analyzing image with Gemini:", error);</span>
<span class="cstat-no" title="statement not covered" >    // Return a default or error-indicating response that matches GeminiAnalysisResult</span>
<span class="cstat-no" title="statement not covered" >    return { description: "Ett fel uppstod vid bildanalys.", geotags: [], aiGeneratedPlaceholder: '', timestamp: new Date().toISOString() };</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >};</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >interface StoryCompilationData {</span>
<span class="cstat-no" title="statement not covered" >  geminiAnalysis?: string;</span>
<span class="cstat-no" title="statement not covered" >  userDescriptions: UserDescriptionEntry[];</span>
<span class="cstat-no" title="statement not covered" >  tags?: string[];</span>
<span class="cstat-no" title="statement not covered" >  imageDate?: string;</span>
<span class="cstat-no" title="statement not covered" >}</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >export const compileStoryWithGemini = async (data: StoryCompilationData): Promise&lt;string&gt; =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  if (!API_KEY) {</span>
<span class="cstat-no" title="statement not covered" >    console.error("VITE_API_KEY not configured for compileStoryWithGemini.");</span>
<span class="cstat-no" title="statement not covered" >    throw new Error("Gemini API Key not configured");</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    let prompt = `Du är en mästerlig historieberättare. Din uppgift är att väva samman den information som tillhandahålls om en bild till ett enda, fängslande berättande stycke PÅ SVENSKA, lämpligt för ett bildspel. Berättelsen ska vara engagerande, målande och flyta naturligt.</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >**Prioritera och integrera Användarnas Berättelser.** Dessa är personliga redogörelser och bör utgöra kärnan i berättelsen om de finns tillgängliga.</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >**Formateringsregler:**</span>
<span class="cstat-no" title="statement not covered" >*   Producera ett enda textblock. Använd inte markdown som \`*\`, \`#\`, eller listpunkter.</span>
<span class="cstat-no" title="statement not covered" >*   Undvik fraser som "Baserat på informationen..." eller "Berättelsen skulle kunna vara...". Berätta direkt historien.</span>
<span class="cstat-no" title="statement not covered" >*   Tonen ska vara stilfull och beskrivande.</span>
<span class="cstat-no" title="statement not covered" >*   ALL output ska vara PÅ SVENSKA.</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >Information:</span>
<span class="cstat-no" title="statement not covered" >Bildens datum: ${data.imageDate || 'Ej specificerat'}</span>
<span class="cstat-no" title="statement not covered" >Taggar: ${data.tags &amp;&amp; data.tags.length &gt; 0 ? data.tags.join(', ') : 'Inga'}</span>
<span class="cstat-no" title="statement not covered" >AI Bildanalys (använd för kontext om det hjälper, men Användarnas Berättelser har företräde): "${data.geminiAnalysis || 'Ej tillhandahållen'}"</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >Användarnas Berättelser:</span>
<span class="cstat-no" title="statement not covered" >${data.userDescriptions &amp;&amp; data.userDescriptions.length &gt; 0</span>
<span class="cstat-no" title="statement not covered" >  ? data.userDescriptions.map(ud =&gt; `- Användare (ID: ${ud.userId}) berättade: "${ud.description}"`).join('\n')</span>
<span class="cstat-no" title="statement not covered" >  : 'Inga användarberättelser tillhandahållna.'</span>
<span class="cstat-no" title="statement not covered" >}</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >Skapa nu berättelsen:`;</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    const textPart: Part = { text: prompt };</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    const response: GenerateContentResponse = await ai.models.generateContent({</span>
<span class="cstat-no" title="statement not covered" >      model: GEMINI_TEXT_MODEL,</span>
<span class="cstat-no" title="statement not covered" >      contents: { parts: [textPart] }, </span>
<span class="cstat-no" title="statement not covered" >      config: {</span>
<span class="cstat-no" title="statement not covered" >        temperature: 0.7,</span>
<span class="cstat-no" title="statement not covered" >        topP: 0.9,</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    });</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    const textOutput = response.text;</span>
<span class="cstat-no" title="statement not covered" >    if (textOutput === undefined) {</span>
<span class="cstat-no" title="statement not covered" >        console.error("[GeminiService] compileStoryWithGemini: Gemini response text is undefined.");</span>
<span class="cstat-no" title="statement not covered" >        throw new Error("Berättelsen kunde inte kompileras då inget textinnehåll mottogs från AI-tjänsten.");</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    let storyText = textOutput.trim();</span>
<span class="cstat-no" title="statement not covered" >    const fenceRegex = /^```(\w*)?\s*\n?(.*?)\n?\s*```$/s;</span>
<span class="cstat-no" title="statement not covered" >    const match = storyText.match(fenceRegex);</span>
<span class="cstat-no" title="statement not covered" >    if (match &amp;&amp; match[2]) {</span>
<span class="cstat-no" title="statement not covered" >      storyText = match[2].trim();</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" >    return storyText;</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >  } catch (error) {</span>
<span class="cstat-no" title="statement not covered" >    console.error("Error compiling story with Gemini:", error);</span>
<span class="cstat-no" title="statement not covered" >    throw new Error(`Fel vid kompilering av berättelse: ${error instanceof Error ? error.message : String(error)}`);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >};</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >export const generateEngagingQuestionFromAnalysis = async (analysisText: string): Promise&lt;string&gt; =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  if (!API_KEY) {</span>
<span class="cstat-no" title="statement not covered" >    console.error("VITE_API_KEY not configured for generateEngagingQuestionFromAnalysis.");</span>
<span class="cstat-no" title="statement not covered" >    return "Vad får den här bilden dig att tänka på?";</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  if (!analysisText || analysisText.trim() === "") {</span>
<span class="cstat-no" title="statement not covered" >     return "Vad får den här bilden dig att tänka på?";</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    const prompt = `Du är en varm och inbjudande historieinspiratör. Baserat på AI-analysen av en bild, gör följande PÅ SVENSKA:</span>
<span class="cstat-no" title="statement not covered" >1.  Börja med en kort (1-2 meningar), positiv och allmän kommentar om bilden. Exempelvis: "Vilken härlig stämning på den bilden!" eller "Det ser ut som ett fint ögonblick."</span>
<span class="cstat-no" title="statement not covered" >2.  Följ sedan upp med EN KORT (max 15 ord), allmän och öppen fråga som uppmuntrar användaren att dela en bredare personlig berättelse, ett minne, vilka som var med, vad de gjorde, eller känslor kopplade till bilden. Exempel på frågor: "Vad gjorde ni där?", "Vilka fler var med och delade det ögonblicket?", "Berätta mer om den dagen!", "Vad kände du just då?".</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >Formatera svaret som en enda sammanhängande text. Undvik markdown. Den totala längden bör vara ungefär 20-30 ord.</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >Exempel på HELA svaret:</span>
<span class="cstat-no" title="statement not covered" >- Analys nämner "solnedgång över ett hav med segelbåtar": "Åh, vilken vacker solnedgång med segelbåtarna! Vad kände du när du såg det?"</span>
<span class="cstat-no" title="statement not covered" >- Analys nämner "en grupp vänner som skrattar runt en lägereld": "Det ser verkligen mysigt ut vid lägerelden! Vilket är ditt bästa minne från den kvällen?"</span>
<span class="cstat-no" title="statement not covered" >- Analys nämner "ett barn som leker med en hund i en park": "Vilken gullig hund och vilket glatt barn! Vad var det roligaste som hände i parken?"</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >AI-analys: "${analysisText}"</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >Din kommentar och fråga:`;</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    const textPart: Part = { text: prompt };</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    const response: GenerateContentResponse = await ai.models.generateContent({</span>
<span class="cstat-no" title="statement not covered" >      model: GEMINI_TEXT_MODEL,</span>
<span class="cstat-no" title="statement not covered" >      contents: { parts: [textPart] },</span>
<span class="cstat-no" title="statement not covered" >      config: {</span>
<span class="cstat-no" title="statement not covered" >        temperature: 0.75, </span>
<span class="cstat-no" title="statement not covered" >        topP: 0.95,</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    });</span>
<span class="cstat-no" title="statement not covered" >    </span>
<span class="cstat-no" title="statement not covered" >    const textOutput = response.text;</span>
<span class="cstat-no" title="statement not covered" >    if (textOutput === undefined) {</span>
<span class="cstat-no" title="statement not covered" >        console.error("[GeminiService] generateEngagingQuestionFromAnalysis: Gemini response text is undefined.");</span>
<span class="cstat-no" title="statement not covered" >        return "Vad är din historia bakom den här bilden?"; // Fallback</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    let questionText = textOutput.trim();</span>
<span class="cstat-no" title="statement not covered" >    const fenceRegex = /^```(\w*)?\s*\n?(.*?)\n?\s*```$/s;</span>
<span class="cstat-no" title="statement not covered" >    const match = questionText.match(fenceRegex);</span>
<span class="cstat-no" title="statement not covered" >    if (match &amp;&amp; match[2]) {</span>
<span class="cstat-no" title="statement not covered" >      questionText = match[2].trim();</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    if (questionText.split(' ').length &gt; 35 || questionText.length === 0) { </span>
<span class="cstat-no" title="statement not covered" >        return "Berätta mer om det här ögonblicket!";</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >    return questionText;</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >  } catch (error) {</span>
<span class="cstat-no" title="statement not covered" >    console.error("Error generating engaging question with Gemini:", error);</span>
<span class="cstat-no" title="statement not covered" >    return "Vad är din historia bakom den här bilden?"; // Fallback on error</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >};</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-07-05T06:09:16.064Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    